////////////////////////////////////////////////////////////////////////////////////////////////////
// Include(s)
////////////////////////////////////////////////////////////////////////////////////////////////////
#include "digital_filters/lowpass.h"

#include <cmath>

////////////////////////////////////////////////////////////////////////////////////////////////////
// Namespace(s)
////////////////////////////////////////////////////////////////////////////////////////////////////
namespace Digital_Filters
{

////////////////////////////////////////////////////////////////////////////////////////////////////
Digital_lowpass::Digital_lowpass(float t_s, float f_c)
    : m_t_s{ t_s }
    , m_f_c{ f_c }
    , m_y_n_1{ 0.0 }
{
    this->update_constants();
}

////////////////////////////////////////////////////////////////////////////////////////////////////
float Digital_lowpass::tick(float x_n)
{
    float y_n{ (this->m_a * x_n) + (this->m_b * this->m_y_n_1) };
    this->m_y_n_1 = y_n;

    return y_n;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
float Digital_lowpass::get_output() const
{
    return this->m_y_n_1;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Digital_lowpass::set_sampling_speed(float t_s)
{
    this->m_t_s = t_s;
    this->update_constants();
}

////////////////////////////////////////////////////////////////////////////////////////////////////
float Digital_lowpass::get_sampling_speed() const
{
    return this->m_t_s;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Digital_lowpass::set_cutoff_frequency(float f_c)
{
    this->m_f_c = f_c;
    this->update_constants();
}

////////////////////////////////////////////////////////////////////////////////////////////////////
float Digital_lowpass::get_cutoff_frequency() const
{
    return this->m_f_c;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
float Digital_lowpass::get_time_constant() const
{
    return this->m_t_c;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Digital_lowpass::update_constants()
{
    if (this->m_f_c == 0.0)
    {
        this->m_f_c = 0.000001;
    }

    this->m_t_c = 1 / (2 * M_PI * this->m_f_c);

    this->m_a = this->m_t_s / (this->m_t_s + this->m_t_c);
    this->m_b = this->m_t_c / (this->m_t_s + this->m_t_c);
}

} // namespace Digital_Filters
